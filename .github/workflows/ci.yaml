name: test

# on:
#     push:
#       branches: 
#         - main
#       paths: 
#         - terraform/**
#     pull_request:
#       branches: 
#         - main
#       paths: 
#         - terraform/**

on:
  workflow_dispatch: 

# env:
#     # credentials for deployment to AWS
#     AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
#     AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
#     # S3 bucket for the terraform state. 
#     BUCKET_TF_STATE: ${{ secrets.BUCKET_TF }}
#     AWS_REGION: eu-central-1

jobs:
  terraform:
    name: "TERRAFORM"
    runs-on: ubuntu-latest
    outputs: 
      my_var: ${{steps.my_step.outputs.my_var}}
    # defaults:
    #   run:
    #     shell: bash
    #     working-directory: ./terraform
    steps:
    - name: "Example output creation"
      id: "my_step"
      run: |
        my_var="Hello World"
        echo "Output $my_var"
        echo "my_var=$my_var" >> $GITHUB_OUTPUT
    
    - name: "Example output call between steps"
      run: |
        echo "Output ${{steps.my_step.outputs.my_var}}"
  
  my_second_job:
    runs-on: ubuntu-latest
    needs: terraform
    steps:
      - run: echo my_var [${{needs.my_job.outputs.my_var}}]